<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>å•è¯æ‰¹é‡è¿›è´§å·¥å…·</title>
    <style>
        body { padding: 20px; font-family: sans-serif; }
        textarea { width: 100%; height: 200px; margin-bottom: 10px; }
        button { padding: 10px 20px; background: #2575fc; color: white; border: none; cursor: pointer; }
        #log { margin-top: 20px; background: #f0f0f0; padding: 10px; height: 300px; overflow-y: scroll; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h2>ğŸšš å•è¯æ‰¹é‡ä¸Šä¼ å·¥å…·</h2>
    <p>è¯·å°† JSON æ•°æ®ç²˜è´´åˆ°ä¸‹æ–¹ï¼š</p>
    <textarea id="data-input" placeholder='[{"f":"apple","b":"è‹¹æœ","rank":1}, ...]'></textarea>
    <button onclick="startUpload()">ğŸš€ å¼€å§‹ä¸Šä¼ </button>
    <div id="log"></div>

    <script>
        // ================= é…ç½® =================
        const BMOB_APP_ID  = "245c234dd2d5ab723c1f00eaca1474cf";
        const BMOB_API_KEY = "999401489c1ab0d956f5f8db34e97afb";
        // =======================================

        function log(msg, type="info") {
            const div = document.getElementById('log');
            div.innerHTML += `<div class="${type}">${msg}</div>`;
            div.scrollTop = div.scrollHeight;
        }

        async function startUpload() {
            const input = document.getElementById('data-input').value;
            let data;
            try {
                data = JSON.parse(input);
            } catch(e) {
                return log("âŒ æ•°æ®æ ¼å¼é”™è¯¯ï¼Œå¿…é¡»æ˜¯æ ‡å‡†çš„ JSON æ ¼å¼", "error");
            }

            if (!Array.isArray(data)) return log("âŒ æ•°æ®å¿…é¡»æ˜¯æ•°ç»„ [...]", "error");

            log(`ğŸ“¦ å‡†å¤‡ä¸Šä¼  ${data.length} ä¸ªå•è¯...`);

            // Bmob æ‰¹é‡æ“ä½œé™åˆ¶æ¯æ¬¡ 50 æ¡ï¼Œæˆ‘ä»¬éœ€è¦åˆ†æ‰¹ä¸Šä¼ 
            const BATCH_SIZE = 50;
            
            for (let i = 0; i < data.length; i += BATCH_SIZE) {
                const chunk = data.slice(i, i + BATCH_SIZE);
                const requests = chunk.map(item => ({
                    "method": "POST",
                    "path": "/1/classes/Words",
                    "body": item
                }));

                try {
                    const res = await fetch(`https://api.bmobcloud.com/1/batch`, {
                        method: "POST",
                        headers: {
                            "X-Bmob-Application-Id": BMOB_APP_ID,
                            "X-Bmob-REST-API-Key": BMOB_API_KEY,
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({ requests: requests })
                    });
                    
                    if(res.ok) {
                        log(`âœ… æˆåŠŸä¸Šä¼ ç¬¬ ${i+1} - ${i+chunk.length} æ¡`, "success");
                    } else {
                        log(`âŒ ä¸Šä¼ å¤±è´¥: ${await res.text()}`, "error");
                    }
                } catch(e) {
                    log(`âŒ ç½‘ç»œé”™è¯¯: ${e.message}`, "error");
                }
                
                // ç¨å¾®ä¼‘æ¯ä¸€ä¸‹ï¼Œé˜²æ­¢æ¥å£é¢‘ç‡è¿‡å¿«
                await new Promise(r => setTimeout(r, 200));
            }
            log("ğŸ‰ å…¨éƒ¨ä¸Šä¼ å®Œæˆï¼");
        }
    </script>
</body>
</html>